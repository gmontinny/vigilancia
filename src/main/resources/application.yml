spring:
  application:
    name: vigilancia
  datasource:
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${POSTGRES_DB:vigilancia}
    username: ${POSTGRES_USER:gmontinny}
    password: ${POSTGRES_PASSWORD:Gmontinny2025}
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
        jdbc.lob.non_contextual_creation: true
        default_schema: ${DB_SCHEMA:app}
  flyway:
    enabled: true
    validate-on-migrate: true
    locations: classpath:db/migration
    default-schema: ${DB_SCHEMA:app}
    schemas: ${DB_SCHEMA:app}
  mail:
    host: ${MAIL_HOST:localhost}
    port: ${MAIL_PORT:1025}
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: ${MAIL_SMTP_AUTH:false}
          starttls:
            enable: ${MAIL_SMTP_STARTTLS:false}

server:
  port: ${SERVER_PORT:8081}

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when_authorized

logging:
  level:
    root: INFO
    org.springframework.security: DEBUG
    org.springframework.security.authentication: DEBUG
    org.hibernate.SQL: INFO
    org.hibernate.type.descriptor.sql.BasicBinder: WARN

minio:
  endpoint: ${MINIO_ENDPOINT:http://localhost:9000}
  access-key: ${MINIO_ACCESS_KEY:minioadmin}
  secret-key: ${MINIO_SECRET_KEY:minioadmin}
  bucket: ${MINIO_BUCKET:vigilancia}
  use-ssl: ${MINIO_USE_SSL:false}
  url-expiration-minutes: ${MINIO_URL_EXP_MINUTES:30}

app:
  frontend:
    reset-password-url: ${APP_FRONTEND_RESET_URL:http://localhost:4200/new-password}
  mail:
    from: ${MAIL_FROM:no-reply@local}

security:
  jwt:
    # Base64 secret (HS256). Override via env JWT_SECRET_BASE64 in production
    secret: ${JWT_SECRET_BASE64:c3ByaW5nLWJvb3Qtc2VjcmV0LXNlZWQta2V5LXNob3VsZC1iZS1sb25nIQ==}
    issuer: ${JWT_ISSUER:vigilancia}
    expiration: ${JWT_EXP_SECONDS:3600}
  cors:
    # Separe múltiplas origens por vírgula. Ex.: http://localhost:4200,https://app.seudominio.gov.br
    allowed-origins: ${SECURITY_CORS_ALLOWED_ORIGINS:http://localhost:4200}
    # Métodos HTTP permitidos nas requisições CORS
    allowed-methods: ${SECURITY_CORS_ALLOWED_METHODS:GET,POST,PUT,PATCH,DELETE,OPTIONS}
    # Cabeçalhos permitidos nas requisições CORS
    allowed-headers: ${SECURITY_CORS_ALLOWED_HEADERS:Authorization,Content-Type,Accept}
    # Permite envio de credenciais (cookies/Authorization). Para front Angular com JWT no header, pode ser true.
    allow-credentials: ${SECURITY_CORS_ALLOW_CREDENTIALS:true}

---
# Dev profile overrides
spring:
  config:
    activate.on-profile: dev
  jpa:
    show-sql: true
management:
  endpoint:
    health:
      show-details: always
logging:
  level:
    org.hibernate.SQL: DEBUG
    org.hibernate.orm.jdbc.bind: TRACE
